<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <!-- WP8/IE Mobile friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <title>Lumia Hub</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app" id="app">
    <!-- Header -->
    <header class="topbar">
      <div class="brand">
        <div class="title">Lumia Hub</div>
        <div class="subtitle">Game ‚Ä¢ Music ‚Ä¢ Story</div>
      </div>

      <div class="actions">
        <button class="icon-btn" id="openSettings" type="button" title="C√†i ƒë·∫∑t" aria-label="Settings">
          <span class="icon">‚öô</span>
        </button>
        <button class="icon-btn" id="toggleTheme" type="button" title="Dark mode" aria-label="Toggle dark mode">
          <span class="icon">‚òæ</span>
        </button>
      </div>
    </header>

    <!-- Search -->
    <section class="searchbar">
      <span class="search-icon">üîé</span>
      <input id="searchInput" type="search" placeholder="T√¨m ki·∫øm (vd: piano, zombie, c·ªï t√≠ch...)"
             autocomplete="off" />
      <button class="pill-btn" id="clearSearch" type="button" title="X√≥a">X</button>
    </section>

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Categories">
      <button class="tab active" data-tab="game" role="tab" aria-selected="true">Game</button>
      <button class="tab" data-tab="music" role="tab" aria-selected="false">Music</button>
      <button class="tab" data-tab="story" role="tab" aria-selected="false">Story</button>

      <div class="tabs-spacer"></div>

      <button class="pill-btn" id="toggleView" type="button" title="Chuy·ªÉn Card/List">
        <span id="viewLabel">Card</span>
      </button>
    </nav>

    <!-- Content -->
    <main class="content">
      <div class="hint" id="resultHint">G√µ ƒë·ªÉ t√¨m ki·∫øm trong tab hi·ªán t·∫°i.</div>

      <section class="grid view-card" id="itemsRoot" aria-live="polite">
        <!-- JS renders -->
      </section>

      <div class="empty" id="emptyState" style="display:none;">
        <div class="empty-title">Kh√¥ng c√≥ k·∫øt qu·∫£</div>
        <div class="empty-sub">Th·ª≠ t·ª´ kh√≥a kh√°c nh√©.</div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="foot-left">WP8 style ‚Ä¢ No libs</div>
      <div class="foot-right" id="statusText">Game ‚Ä¢ 0 k·∫øt qu·∫£</div>
    </footer>
  </div>

  <!-- Story Overlay (Reader + AI + Voice) -->
  <div class="overlay" id="storyOverlay" aria-hidden="true">
    <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="storyTitle">
      <div class="overlay-top">
        <button class="back-btn" id="storyClose" type="button">‚Üê Back</button>
        <div class="overlay-actions">
          <button class="pill-btn" id="storySave" type="button" title="L∆∞u truy·ªán AI">Save</button>
        </div>
      </div>

      <div class="detail-head">
        <div class="tile big" id="storyTile">S</div>
        <div class="detail-head-text">
          <div class="detail-title" id="storyTitle">Story</div>
          <div class="detail-meta" id="storyMeta">Story ‚Ä¢ Reader</div>
          <div class="detail-badges" id="storyBadges"></div>
        </div>
      </div>

      <div class="overlay-tabs">
        <button class="mini-tab active" id="modeRead" type="button">ƒê·ªçc</button>
        <button class="mini-tab" id="modeAI" type="button">AI K·ªÉ</button>
        <button class="mini-tab" id="modeVoice" type="button">AI ƒê·ªçc</button>
      </div>

      <!-- READ MODE -->
      <div class="detail-body" id="panelRead">
        <div class="detail-section">
          <div class="detail-label">N·ªôi dung</div>
          <div class="story-text" id="storyText"></div>
        </div>

        <div class="detail-section">
          <div class="detail-label">Hi·ªÉn th·ªã</div>
          <div class="row">
            <label class="row-item">
              C·ª° ch·ªØ
              <select id="fontSize">
                <option value="16">16</option>
                <option value="18" selected>18</option>
                <option value="20">20</option>
                <option value="22">22</option>
              </select>
            </label>

            <label class="row-item">
              Gi√£n d√≤ng
              <select id="lineHeight">
                <option value="1.35">1.35</option>
                <option value="1.5" selected>1.5</option>
                <option value="1.65">1.65</option>
                <option value="1.8">1.8</option>
              </select>
            </label>
          </div>
        </div>
      </div>

      <!-- AI MODE -->
      <div class="detail-body" id="panelAI" style="display:none;">
        <div class="detail-section">
          <div class="detail-label">AI K·ªÉ truy·ªán (Gemini)</div>
          <div class="ai-box">
            <label class="ai-row">
              <span>Ch·ªß ƒë·ªÅ</span>
              <input id="aiTopic" type="text" placeholder="vd: Ch√∫ m√®o l·∫°c ·ªü H√† N·ªôi" />
            </label>

            <label class="ai-row">
              <span>Th·ªÉ lo·∫°i</span>
              <select id="aiGenre">
                <option value="c·ªï t√≠ch" selected>C·ªï t√≠ch</option>
                <option value="phi√™u l∆∞u">Phi√™u l∆∞u</option>
                <option value="h·ªçc ƒë∆∞·ªùng">H·ªçc ƒë∆∞·ªùng</option>
                <option value="h√†i h∆∞·ªõc">H√†i h∆∞·ªõc</option>
                <option value="kinh d·ªã nh·∫π">Kinh d·ªã nh·∫π</option>
                <option value="khoa h·ªçc vi·ªÖn t∆∞·ªüng">Khoa h·ªçc vi·ªÖn t∆∞·ªüng</option>
              </select>
            </label>

            <div class="row">
              <label class="row-item">
                ƒê·ªô d√†i
                <select id="aiLenPreset">
                  <option value="short" selected>Ng·∫Øn</option>
                  <option value="medium">V·ª´a</option>
                  <option value="long">D√†i</option>
                  <option value="custom">Tu·ª≥ ch·ªânh</option>
                </select>
              </label>

              <label class="row-item" id="aiLenCustomWrap" style="display:none;">
                S·ªë t·ª´
                <input id="aiLenWords" type="number" min="200" max="4000" step="50" value="800" />
              </label>
            </div>

            <label class="ai-row">
              <span>Phong c√°ch</span>
              <input id="aiStyle" type="text" placeholder="vd: nh·∫π nh√†ng, vui t∆∞∆°i, k·∫øt th√∫c c√≥ b√†i h·ªçc" />
            </label>

            <div class="row">
              <button class="pill-btn wide" id="aiGenerate" type="button">‚ú® T·∫°o truy·ªán</button>
              <button class="pill-btn wide" id="aiUseToRead" type="button">ƒê∆∞a sang tab ƒê·ªçc</button>
            </div>

            <div class="ai-status" id="aiStatus"></div>
          </div>
        </div>
      </div>

      <!-- VOICE MODE (CENTER + SEEK + SPEED + OS TTS FALLBACK) -->
      <div class="detail-body" id="panelVoice" style="display:none;">
        <div class="detail-section tts-center">
          <div style="width:100%;">
            <div class="detail-label">AI ƒê·ªçc (Gemini TTS)</div>

            <div class="ai-box tts-box">
              <div class="warn">
                Lumia/WP8 c√≥ th·ªÉ kh√¥ng ph√°t ƒë∆∞·ª£c audio t·ª´ Blob/WAV. N·∫øu kh√¥ng nghe ƒë∆∞·ª£c, d√πng ‚Äúƒê·ªçc b·∫±ng m√°y‚Äù.
              </div>

              <label class="ai-row">
                <span>Gi·ªçng (Gemini)</span>
                <input id="ttsVoice" type="text" value="Kore" />
              </label>

              <label class="ai-row">
                <span>Gi·ªõi h·∫°n ƒë·ªçc (k√Ω t·ª±)</span>
                <select id="ttsLimit">
                  <option value="800">Ng·∫Øn (800)</option>
                  <option value="1400" selected>V·ª´a (1400)</option>
                  <option value="2400">D√†i (2400)</option>
                </select>
              </label>

              <label class="ai-row">
                <span>T·ªëc ƒë·ªô</span>
                <select id="ttsSpeed">
                  <option value="0.75">0.75√ó</option>
                  <option value="1" selected>1√ó</option>
                  <option value="1.25">1.25√ó</option>
                  <option value="1.5">1.5√ó</option>
                  <option value="2">2√ó</option>
                </select>
              </label>

              <div class="row">
                <button class="pill-btn wide" id="ttsSpeak" type="button">üîä AI ƒë·ªçc</button>
                <button class="pill-btn wide" id="ttsStop" type="button">Stop</button>
              </div>

              <audio id="ttsPlayer" controls style="width:100%; margin-top:10px;"></audio>

              <div class="tts-seek">
                <button class="pill-btn" id="ttsRew" type="button">‚ü≤ 10s</button>
                <div class="tts-seek-mid">
                  <input id="ttsSeek" type="range" min="0" max="1000" value="0" />
                  <div class="tts-time" id="ttsTime">00:00 / 00:00</div>
                </div>
                <button class="pill-btn" id="ttsFwd" type="button">10s ‚ü≥</button>
              </div>

              <div class="row" style="margin-top:10px;">
                <button class="pill-btn wide" id="osSpeak" type="button">üó£ ƒê·ªçc b·∫±ng m√°y</button>
                <button class="pill-btn wide" id="osStop" type="button">D·ª´ng m√°y</button>
              </div>

              <div class="ai-status" id="ttsStatus"></div>
              <div class="ai-status" id="osTtsStatus"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="overlay" id="settingsOverlay" aria-hidden="true">
    <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="overlay-top">
        <button class="back-btn" id="settingsClose" type="button">‚Üê Back</button>
        <div class="overlay-actions"></div>
      </div>

      <div class="detail-head">
        <div class="tile big">‚öô</div>
        <div class="detail-head-text">
          <div class="detail-title" id="settingsTitle">C√†i ƒë·∫∑t</div>
          <div class="detail-meta">Gemini API Key</div>
          <div class="detail-badges"></div>
        </div>
      </div>

      <div class="detail-body">
        <div class="detail-section">
          <div class="detail-label">API Key</div>
          <div class="warn">
            B·∫°n ƒëang deploy GitHub Pages: API key ƒë·ªÉ trong JS s·∫Ω b·ªã l·ªô.
            N·∫øu v·∫´n mu·ªën: d√°n v√†o script.js ho·∫∑c l∆∞u t·∫°m ·ªü ƒë√¢y.
          </div>
          <input id="apiKeyInput" type="password" placeholder="D√°n API key v√†o ƒë√¢y" />
          <div class="row" style="margin-top:10px;">
            <button class="pill-btn wide" id="saveApiKey" type="button">Save key</button>
            <button class="pill-btn wide" id="clearApiKey" type="button">Clear</button>
          </div>
          <div class="ai-status" id="settingsStatus"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
